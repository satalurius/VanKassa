<EditForm>
    <DataAnnotationsValidator/>
    <MudGrid
        Spacing="6"
        Class="mt-8"
        Justify="Justify.Center">
        <MudItem xs="9">
            <MudGrid>
                <MudItem xs="4">
                    <MudTextField
                        @bind-Value="EditedEmployee.LastName"
                        T="string"
                        Label="Фамилия"
                        For="@(() => EditedEmployee.LastName)"/>
                </MudItem>
                <MudItem xs="4">
                    <MudTextField
                        @bind-Value="EditedEmployee.FirstName"
                        T="string"
                        Label="Имя"
                        For="@(() => EditedEmployee.LastName)"/>
                </MudItem>
                <MudItem xs="4">
                    <MudTextField
                        @bind-Value="EditedEmployee.Patronymic"
                        T="string"
                        Label="Отчество"
                        For="@(() => EditedEmployee.Patronymic)"/>
                </MudItem>
                <MudItem xs="12">
                    <MudSelect
                        T="EmployeeRoleViewModel"
                        Label="Должность"
                        AnchorOrigin="Origin.BottomCenter"
                        @bind-SelectedValues="EditedEmployee.Roles">
                        @foreach (var role in employeeRoles)
                        {
                            <MudSelectItem T="EmployeeRoleViewModel" Value="@role">@role.RoleName</MudSelectItem>
                        }
                    </MudSelect>
                </MudItem>

                <MudItem xs="12">
                    <MudSelect
                        T="EmployeeOutletViewModel"
                        MultiSelection="true"
                        Text="@outletsSelectedText"
                        Label="Рабочие точки"
                        SelectedValues="@EditedEmployee.Outlets"
                        AnchorOrigin="Origin.BottomCenter">
                        @foreach (var outlet in outlets)
                        {
                            <MudSelectItem T="EmployeeOutletViewModel" Value="@outlet">
                                @outlet.Address
                            </MudSelectItem>
                        }
                    </MudSelect>
                </MudItem>

                <MudItem xs="12">
                    <MudFileUpload T="IBrowserFile" Accept=".jpg, .jpeg, .png" Context="files_upload_context">
                        <ButtonTemplate>
                            <MudButton HtmlTag="label"
                                       Variant="Variant.Filled"
                                       Color="Color.Primary"
                                       StartIcon="@Icons.Material.Filled.Image"
                                       for="@files_upload_context">
                                Загрузить фотографию
                            </MudButton>
                        </ButtonTemplate>
                    </MudFileUpload>
                    @if (imageFiles is not null)
                    {
                        <MudList>
                            @foreach (var file in imageFiles)
                            {
                                <MudListItem Icon="@Icons.Material.Filled.AttachFile" @key="@file">
                                    @file.Name <code>@file.Size bytes</code>
                                </MudListItem>
                            }
                        </MudList>
                    }
                </MudItem>
            </MudGrid>

            <MudItem xs="12" Class="d-flex justify-end">
                <MudButton
                    Variant="Variant.Filled"
                    DisableElevation="true"
                    Color="Color.Secondary"
                    Size="Size.Large"
                    Class="mt-8 me-1">
                    Отмена
                </MudButton>
                <MudButton
                    ButtonType="ButtonType.Submit"
                    Variant="Variant.Filled"
                    DisableElevation="true"
                    Color="Color.Primary"
                    Size="Size.Large"
                    Class="mt-8">
                    Сохранить
                </MudButton>
            </MudItem>

        </MudItem>
    </MudGrid>
</EditForm>

@code {
    private string outletsSelectedText = string.Empty;
    //TODO: Переделать selectedRoles под одиночный элемент. 
    private List<EmployeeRoleViewModel> employeeRoles = new();
    private List<EmployeeOutletViewModel> outlets = new();
    IList<IBrowserFile> imageFiles = new List<IBrowserFile>();

    private bool isPageForEditing;

    [Parameter]
    public EditedEmployeeViewModel EditedEmployee { get; set; } = new();

    [Parameter]
    public int? EmployeeId { get; set; }

}